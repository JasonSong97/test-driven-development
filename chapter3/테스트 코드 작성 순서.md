# 테스트 코드 작성 순서

## 테스트 코드 작성 순서

2번째 chapter에서 아래와 같은 순서로 테스트 코드를 작성했다.

> 1. 모든 규칙을 충족하는 암호 강도는 강함
> 2. 길이만 8글자 미만이고 나머지 규칙은 충족하는 암호의 강도는 '보통'
> 3. 숫자를 포함하지 않고 나머지 규칙은 충족하는 암호의 강도는 '보통'
> 4. 값이 없는 암호의 강도는 '유효하지 않음'
> 5. 대문자를 포함하지 않고 나머지 규칙은 충족하는 경우
> 6. 길이가 8글자 이상인 규칙만 충족하는 경우
> 7. 숫자 포함 규칙만 충족하는 경우
> 8. 대문자 포함 규칙만 충족하는 경우
> 9. 아무 규칙도 충족하지 않는 경우

- 쉬운 경우....어려운 경우
- 예외적인 경우....정상인 경우

### 초반에 복잡한 테스트부터 시작하면 안 되는 이유

초반에 복잡한 테스트로 시작하면 한 번에 구현해야 할 코드가 많아지기 때문이다. 또한 스스로도 모르게 버그를 만들고 나중에 버그를 잡기 위해 많은 시간을 허비하게 된다.

### 구현하기 쉬운 테스트부터 시작

가장 구현하기 쉬운 경우부터 시작하면 테스트를 빠르게 통과시킬 수 있다.

### 예외 상횡을 먼저 테스트해야 하는 이유

예외 상황은 if-else를 동반하기 때문에, 버그 발생 가능성이 높다. 따라서 초반에 예외 상횡을 테스트하면서 이런 가능성을 줄이는 것이다.

즉, 미리 기능 중심의 코드를 작업하고 예외코드를 반영하면 많은 것이 바뀌어야 하기 때문에, 예외 코드를 먼저 반영해야 한다.

### 완급조절

일단 아래와 같은 순서를 따라간다.

> 1. 정해진 값을 리턴
> 2. 값 비교를 이용해서 정해진 값을 리턴
> 3. 다양한 테스트를 추가함녀서 구현을 일반화

### 지속적인 리펙토링

테스트를 통과하고 난 뒤에는 전체적으로 코드를 필요한 부분이 보이면 라팩토링을 한다. 이는 향후 코드의 품질과 유지보수에 많은 도움을 준다.

## 테스트 시나리오 정의

TDD를 시작할 때 테스트 시나리오를 목록으로 만들어야 한다.

- 1만 원 납부하면 한 달 뒤가 만료일
- 달의 마지막 날에 납부하면 다음달 마지막 날이 만료일
- 2만 원 납부하면 2개월 뒤가 만료일
- 3만 원 납부하면 3개우러 뒤가 만료일
- 10만 원을 납부하면 1년 뒤가 만료일

> - 테스트 시나리오 설계
> - 어떤 테스트가 구현이 쉬울지 상상 + 어떤 테스트가 예외적인 상황인지 상상
> - 테스트 목록을 적었다고 한 번에 작성 금지
> - 지속적인 리펙토링과 테스트 코드를 통해 비즈니스 코드를 보완할 것

## 처음은 단언 부터 고민하자

먼저 검증하는 코드부터 작성하자. 예를 들어 만료일 계산 기능의 경우 만료일을 검증하는 코드부터 작성하는 것이다.

```java
@Test
void 만원_납부하면_한달_뒤가_만료일이_됨() {
    // given

    // when

    // then
    assertEquals(기댓값, 실제값);
}
```

이제 만료일을 어떻게 표한할지 결정하면 된다. 날짜이기 때문에 LocalDate를 사용할 것이다.

```java
@Test
void 만원_납부하면_한달_뒤가_만료일이_됨() {
    // given

    // when

    // then
    assertEquals(LocalDate.of(2019, 8, 9), 실제값);
}
```

실제 만료일을 바꿔보자.

```java
@Test
void 만원_납부하면_한달_뒤가_만료일이_됨() {
    // given
    LocalDate realExpiryDate = 계산하기;

    // when

    // then
    assertEquals(LocalDate.of(2019, 8, 9), realExpiryDate);
}
```

이제는 realExpiryDate를 구하는 코드를 작성하면 된다.

```java
@Test
void 만원_납부하면_한달_뒤가_만료일이_됨() {
    // given
    LocalDate realExpiryDate = cal.calculateExpiryDate(파라미터);

    // when

    // then
    assertEquals(LocalDate.of(2019, 8, 9), realExpiryDate);
}
```

어떤 파라미터를 제공할지 생각하고 cal은 어떤 타입의 변수로 지정할지 생각한다.

```java
@Test
void 만원_납부하면_한달_뒤가_만료일이_됨() {
    // given
    ExpiryDateCalculator cal = new ExpiryDateCalculator();
    LocalDate realExpiryDate = cal.calculateExpiryDate(LocalDate.of(2019, 7, 9), 10_000);

    // when

    // then
    assertEquals(LocalDate.of(2019, 8, 9), realExpiryDate);
}
```

## 구현이 막히는 경우

- 쉬운 테스트, 예외적인 테스트
- 완급 조절